<!DOCTYPE html>
<html>
<head>
	<title>Death 'til the Break of Dawn</title>
  <script src="processing-1.3.6.js"></script>
</head>

<body>
<!-- <h2>to be named</h2> -->

<p>
<canvas id="canvas1" width="512" height="384"></canvas>
</p>

<script id="script1" type="text/javascript">

// Simple way to attach js code to the canvas is by using a function
function sketchProc(processing) {

	// Constants
	const ScreenWidth = 512;
	const ScreenHeight = 384;
	const Colors = {
		"Blue": processing.color(0, 0, 255),
		"Red": processing.color(255, 0, 0)
	};
	
	// Layers, listed in draw order
	var BackgroundLayer;
	var TerrainLayer;
	
	// Images
	var Background_1_Image;
	
	// Tanks
	var Tanks = new Array();
	
	// Tank class
	function Tank(cx, cy, color) {
		this.cx = cx;
		this.cy = cy;
		this.width = 16;
		this.height = 10;
		
		if (color == null) {
			color = processing.color(255, 0, 0);
		}
		this.color = color;
	}
	
	Tank.prototype.draw = function () {
		//console.log("draw tank at " + this.x + ", " + this.y);
		processing.rectMode(processing.CENTER);
		processing.fill(this.color);
		processing.noStroke();
		processing.rect(this.cx,
						this.cy,
						this.width,
						this.height);
	}
	
  	processing.setup = function () {
		console.log("setup called");
		
		processing.size(ScreenWidth, ScreenHeight);
		
		// Create PImages from pre-loaded images
		Background_1_Image = processing.loadImage("Assets/Images/Background_1.png");
		
		// var processingCode = "PImage TerrainLayer = createImage( 120, 120, RGB ); TerrainLayer.pixels[0] = color(1, 2, 3, 4);";
		// var jsCode = Processing.compile(processingCode).sourceCode;
		// console.log(jsCode);
		
		// Init Layers
		BackgroundLayer = processing.createGraphics(ScreenWidth, ScreenHeight, processing.P3D);
		BackgroundLayer.beginDraw();
		BackgroundLayer.background(0, 0, 0, 255);
		BackgroundLayer.endDraw();
		
		TerrainLayer = processing.createGraphics(ScreenWidth, ScreenHeight, processing.P3D);
		TerrainLayer.beginDraw();
		TerrainLayer.background(0, 0, 0, 0);			// fill with blank pixels
		TerrainLayer.image(Background_1_Image, 0, 0);	// draw the image on top of it
		TerrainLayer.endDraw();
		
		// Init Tanks
		Tanks.push(new Tank(60, 253, Colors.Blue));
		Tanks.push(new Tank(410, 288, Colors.Red));
		
		console.log("setup done!");
	}

	processing.draw = function() {
		processing.background(204);
		processing.image(BackgroundLayer, 0, 0);
		processing.image(TerrainLayer, 0, 0);
		for (var i = 0; i < Tanks.length; i++) {
			Tanks[i].draw();
		}
	};
  
	processing.keyPressed = function () {
		console.log("key pressed: " + processing.key);
	};
}

sketch = new Processing.Sketch(sketchProc);
const NumImagesToLoad = 1;
var NumImagesLoaded = 0;
var Background_1 = new Image(),
    canvas1 = document.getElementById('canvas1'),
    sketch,
    processing;

function OnImageLoaded() {
	NumImagesLoaded++;
	if (NumImagesLoaded == NumImagesToLoad) {
		// Once all of the images are loaded, start the Processing sketch.
		processing = new Processing(canvas1, sketch);
	}
}

Background_1.onload = function() {
	sketch.imageCache.add("Assets/Images/Background_1.png", Background_1);
	OnImageLoaded();
};

Background_1.src = "Assets/Images/Background_1.png";

</script>

</body>
</html>
